<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ModelFinder v3.0 - å·¥ä½œæµæ¨¡å‹åˆ†æ</title>
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Element Plus CDN -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    
    <!-- Element Plus å›¾æ ‡ -->
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .app-container {
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-card {
            max-width: 1400px;
            margin: 0 auto;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 24px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 24px;
        }
        
        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .upload-area {
            border: 3px dashed #d9d9d9;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: #fafafa;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .upload-area:hover {
            border-color: #4facfe;
            background: #f0f9ff;
        }
        
        .upload-area.dragover {
            border-color: #4facfe;
            background: #e6f7ff;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #8c8c8c;
            margin-bottom: 12px;
        }
        
        .upload-text {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 6px;
        }
        
        .upload-hint {
            font-size: 0.9rem;
            color: #999;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            gap: 12px;
        }
        
        .form-row label {
            width: 120px;
            text-align: right;
            font-weight: 500;
        }
        
        .form-row .el-input {
            flex: 1;
        }
        
        /* æŒ‰é’®åŒºåŸŸ */
        .button-group {
            display: flex;
            gap: 12px;
            margin: 20px 0;
        }
        
        /* è¿›åº¦æ¡åŒºåŸŸ */
        .progress-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        /* æ—¥å¿—åŒºåŸŸ */
        .log-section {
            margin-top: 20px;
        }
        
        .log-container {
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
            height: 300px;
            overflow-y: auto;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .log-entry {
            margin-bottom: 4px;
        }
        
        .log-entry.info {
            color: #666;
        }
        
        .log-entry.success {
            color: #52c41a;
        }
        
        .log-entry.error {
            color: #f5222d;
        }
        
        .log-entry.warning {
            color: #faad14;
        }
        
        /* è®¾ç½®é¡µé¢æ ·å¼ */
        .settings-section {
            margin-bottom: 24px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #e8e8e8;
        }
        
        .settings-section h3 {
            margin-bottom: 16px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        /* ç»“æœå¯¹è¯æ¡†æ ·å¼ */
        .result-dialog .el-message-box {
            width: 80%;
            max-width: 800px;
        }
        
        .result-dialog .el-message-box__content {
            max-height: 60vh;
            overflow-y: auto;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .content {
                padding: 16px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .form-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .form-row label {
                width: auto;
                text-align: left;
                margin-bottom: 4px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .result-dialog .el-message-box {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <div class="main-card">
                <!-- å¤´éƒ¨ -->
                <div class="header">
                    <h1>ğŸ” ModelFinder</h1>
                    <p>ComfyUI å·¥ä½œæµæ¨¡å‹åˆ†æå·¥å…· v3.0</p>
                </div>
                
                <!-- ä¸»è¦å†…å®¹ -->
                <div class="content">
                    <!-- åŠŸèƒ½æ ‡ç­¾é¡µ -->
                    <el-tabs v-model="activeTab" type="border-card" @tab-change="handleTabChange">
                        
                        <!-- å•ä¸ªå¤„ç†æ ‡ç­¾é¡µ -->
                        <el-tab-pane label="ğŸ¯ å•ä¸ªå¤„ç†" name="single">
                            <div class="form-row">
                                <label>å·¥ä½œæµæ–‡ä»¶:</label>
                                <el-input 
                                    v-model="singleData.workflowPath" 
                                    placeholder="é€‰æ‹©å·¥ä½œæµJSONæ–‡ä»¶"
                                    readonly
                                ></el-input>
                                <el-button @click="browseSingleWorkflow">æµè§ˆ...</el-button>
                            </div>
                            
                            <!-- æ”¯æŒæ‹–æ‹½ä¸Šä¼ çš„åŒºåŸŸ -->
                            <div 
                                class="upload-area"
                                :class="{ 'dragover': isDragOver }"
                                @click="triggerFileInput"
                                @dragover.prevent="handleDragOver"
                                @dragleave.prevent="handleDragLeave"
                                @drop.prevent="handleDrop"
                            >
                                <div class="upload-icon">ğŸ“</div>
                                <div class="upload-text">
                                    {{ singleData.selectedFile ? singleData.selectedFile.name : 'æ‹–æ‹½ JSON å·¥ä½œæµæ–‡ä»¶åˆ°è¿™é‡Œ' }}
                                </div>
                                <div class="upload-hint">æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ â€¢ æ”¯æŒ ComfyUI å·¥ä½œæµæ ¼å¼</div>
                                
                                <input 
                                    ref="fileInput"
                                    type="file" 
                                    accept=".json"
                                    style="display: none"
                                    @change="handleFileSelect"
                                >
                            </div>
                            
                            <div class="button-group">
                                <el-button 
                                    type="primary" 
                                    :disabled="!singleData.selectedFile && !singleData.workflowPath" 
                                    :loading="singleData.isAnalyzing"
                                    @click="analyzeSingle"
                                >
                                    ğŸš€ ä¸€é”®åˆ†æå¹¶æœç´¢
                                </el-button>
                                <el-button 
                                    :disabled="!singleData.hasResults" 
                                    @click="viewSingleResult"
                                >
                                    ğŸ‘ï¸ æŸ¥çœ‹ç»“æœ
                                </el-button>
                            </div>
                            
                            <!-- è¿›åº¦æ¡ -->
                            <div v-if="singleData.isAnalyzing" class="progress-section">
                                <div style="margin-bottom: 12px;">
                                    <strong>ğŸ“Š è¿›åº¦: {{ singleData.progressText }}</strong>
                                </div>
                                <el-progress 
                                    :percentage="singleData.progressPercent" 
                                    :status="singleData.progressStatus"
                                    :stroke-width="12"
                                ></el-progress>
                            </div>
                            
                            <!-- å¤„ç†æ—¥å¿— -->
                            <div class="log-section">
                                <h4 style="margin-bottom: 12px;">ğŸ“ å¤„ç†æ—¥å¿—:</h4>
                                <div class="log-container" ref="singleLogContainer">
                                    <div 
                                        v-for="(log, index) in singleData.logs" 
                                        :key="index" 
                                        class="log-entry"
                                        :class="log.type"
                                    >
                                        {{ log.timestamp }} - {{ log.message }}
                                    </div>
                                    <div v-if="singleData.logs.length === 0" style="color: #999; text-align: center; padding: 20px;">
                                        ç­‰å¾…å¼€å§‹åˆ†æ...
                                    </div>
                                </div>
                            </div>
                        </el-tab-pane>
                        
                        <!-- æ‰¹é‡å¤„ç†æ ‡ç­¾é¡µ -->
                        <el-tab-pane label="ğŸ“¦ æ‰¹é‡å¤„ç†" name="batch">
                            <div class="form-row">
                                <label>å·¥ä½œæµç›®å½•:</label>
                                <el-input 
                                    v-model="batchData.workflowDir" 
                                    placeholder="é€‰æ‹©åŒ…å«å·¥ä½œæµæ–‡ä»¶çš„ç›®å½•"
                                ></el-input>
                                <el-button @click="browseBatchWorkflowDir">æµè§ˆ...</el-button>
                            </div>
                            
                            <div class="form-row">
                                <label>æ–‡ä»¶æ ¼å¼:</label>
                                <el-input 
                                    v-model="batchData.filePattern" 
                                    placeholder="ä¾‹å¦‚: *.json;*"
                                    style="width: 200px;"
                                ></el-input>
                            </div>
                            
                            <div class="form-row">
                                <label></label>
                                <el-checkbox v-model="batchData.autoOpenResult">è‡ªåŠ¨æ‰“å¼€ç»“æœ</el-checkbox>
                            </div>
                            
                            <div class="button-group">
                                <el-button 
                                    type="primary" 
                                    :disabled="!batchData.workflowDir" 
                                    :loading="batchData.isProcessing"
                                    @click="startBatchProcess"
                                >
                                    ğŸš€ å¼€å§‹å¤„ç†å¹¶æœç´¢
                                </el-button>
                            </div>
                            
                            <!-- è¿›åº¦æ¡ -->
                            <div v-if="batchData.isProcessing" class="progress-section">
                                <div style="margin-bottom: 12px;">
                                    <strong>ğŸ“Š è¿›åº¦: {{ batchData.progressText }}</strong>
                                </div>
                                <el-progress 
                                    :percentage="batchData.progressPercent" 
                                    :status="batchData.progressStatus"
                                    :stroke-width="12"
                                ></el-progress>
                            </div>
                            
                            <!-- å¤„ç†ç»“æœ -->
                            <div style="margin-top: 20px;">
                                <h4 style="margin-bottom: 12px;">ğŸ“‹ å¤„ç†ç»“æœ:</h4>
                                <div style="margin-bottom: 16px;">
                                    <el-button 
                                        :disabled="batchData.results.length === 0" 
                                        @click="viewBatchHtml"
                                    >
                                        ğŸŒ æŸ¥çœ‹æ±‡æ€»HTMLç»“æœ
                                    </el-button>
                                </div>
                                
                                <el-table 
                                    :data="batchData.results" 
                                    style="width: 100%"
                                    :height="300"
                                >
                                    <el-table-column prop="filename" label="æ–‡ä»¶å" width="300"></el-table-column>
                                    <el-table-column prop="missingCount" label="ç¼ºå¤±æ•°é‡" width="120" align="center"></el-table-column>
                                    <el-table-column prop="status" label="çŠ¶æ€" width="120" align="center">
                                        <template #default="scope">
                                            <el-tag 
                                                :type="scope.row.status === 'å®Œæˆ' ? 'success' : 
                                                      scope.row.status === 'é”™è¯¯' ? 'danger' : 'warning'"
                                            >
                                                {{ scope.row.status }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </div>
                        </el-tab-pane>
                        
                        <!-- ä¸è§„åˆ™åç§°æ˜ å°„æ ‡ç­¾é¡µ -->
                        <el-tab-pane label="ğŸ”„ ä¸è§„åˆ™åç§°æ˜ å°„" name="irregular">
                            <div style="margin-bottom: 16px; display: flex; gap: 12px; align-items: flex-end;">
                                <el-form-item label="åŸå§‹åç§°">
                                    <el-input 
                                        v-model="irregularData.newMapping.original" 
                                        placeholder="è¾“å…¥åŸå§‹æ¨¡å‹åç§°"
                                        style="width: 200px;"
                                    ></el-input>
                                </el-form-item>
                                <el-form-item label="ä¿®æ­£åç§°">
                                    <el-input 
                                        v-model="irregularData.newMapping.corrected" 
                                        placeholder="è¾“å…¥ä¿®æ­£åçš„åç§°"
                                        style="width: 200px;"
                                    ></el-input>
                                </el-form-item>
                                <el-form-item label="å¤‡æ³¨">
                                    <el-input 
                                        v-model="irregularData.newMapping.notes" 
                                        placeholder="å¯é€‰å¤‡æ³¨ä¿¡æ¯"
                                        style="width: 150px;"
                                    ></el-input>
                                </el-form-item>
                                <el-button 
                                    type="primary" 
                                    :disabled="!irregularData.newMapping.original || !irregularData.newMapping.corrected"
                                    @click="addMapping"
                                >
                                    â• æ·»åŠ æ˜ å°„
                                </el-button>
                            </div>
                            
                            <el-table 
                                :data="irregularData.mappings" 
                                style="width: 100%"
                                :height="500"
                            >
                                <el-table-column prop="original_name" label="åŸå§‹åç§°" width="250"></el-table-column>
                                <el-table-column prop="corrected_name" label="ä¿®æ­£åç§°" width="250"></el-table-column>
                                <el-table-column prop="notes" label="å¤‡æ³¨" min-width="200"></el-table-column>
                                <el-table-column label="æ“ä½œ" width="120" align="center">
                                    <template #default="scope">
                                        <el-button 
                                            size="small" 
                                            type="danger" 
                                            @click="deleteMapping(scope.row)"
                                        >
                                            åˆ é™¤
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            
                            <div style="margin-top: 16px; color: #666; font-size: 14px;">
                                æ€»è®¡: {{ irregularData.mappings.length }} æ¡æ˜ å°„è®°å½•
                            </div>
                        </el-tab-pane>
                        
                        <!-- æ¨¡å‹é…ç½®æ ‡ç­¾é¡µ -->
                        <el-tab-pane label="âš™ï¸ æ¨¡å‹é…ç½®" name="config">
                            <div style="margin-bottom: 20px;">
                                <el-button @click="refreshModelConfig">ğŸ”„ åˆ·æ–°é…ç½®</el-button>
                                <el-button @click="resetModelConfig">ğŸ”§ é‡ç½®ä¸ºé»˜è®¤</el-button>
                            </div>
                            
                            <el-tabs v-model="configData.activeSubTab" type="card">
                                <el-tab-pane label="ğŸ“ èŠ‚ç‚¹ç±»å‹é…ç½®" name="nodeTypes">
                                    <div style="margin-bottom: 16px;">
                                        <el-input 
                                            v-model="configData.newNodeType" 
                                            placeholder="æ·»åŠ æ–°çš„èŠ‚ç‚¹ç±»å‹"
                                            style="width: 300px; margin-right: 12px;"
                                        ></el-input>
                                        <el-button 
                                            type="primary" 
                                            :disabled="!configData.newNodeType"
                                            @click="addNodeType"
                                        >
                                            â• æ·»åŠ èŠ‚ç‚¹ç±»å‹
                                        </el-button>
                                    </div>
                                    
                                    <el-table 
                                        :data="configData.nodeTypes" 
                                        style="width: 100%"
                                        :height="400"
                                    >
                                        <el-table-column prop="name" label="èŠ‚ç‚¹ç±»å‹" min-width="200"></el-table-column>
                                        <el-table-column label="æ“ä½œ" width="120" align="center">
                                            <template #default="scope">
                                                <el-button 
                                                    size="small" 
                                                    type="danger" 
                                                    @click="removeNodeType(scope.row, scope.$index)"
                                                >
                                                    åˆ é™¤
                                                </el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </el-tab-pane>
                                
                                <el-tab-pane label="ğŸ“„ æ–‡ä»¶æ‰©å±•å" name="extensions">
                                    <div style="margin-bottom: 16px;">
                                        <el-input 
                                            v-model="configData.newExtension" 
                                            placeholder="æ·»åŠ æ–°çš„æ–‡ä»¶æ‰©å±•å (å¦‚: .safetensors)"
                                            style="width: 300px; margin-right: 12px;"
                                        ></el-input>
                                        <el-button 
                                            type="primary" 
                                            :disabled="!configData.newExtension"
                                            @click="addExtension"
                                        >
                                            â• æ·»åŠ æ‰©å±•å
                                        </el-button>
                                    </div>
                                    
                                    <el-table 
                                        :data="configData.extensions" 
                                        style="width: 100%"
                                        :height="400"
                                    >
                                        <el-table-column prop="extension" label="æ–‡ä»¶æ‰©å±•å" min-width="200"></el-table-column>
                                        <el-table-column label="æ“ä½œ" width="120" align="center">
                                            <template #default="scope">
                                                <el-button 
                                                    size="small" 
                                                    type="danger" 
                                                    @click="removeExtension(scope.row, scope.$index)"
                                                >
                                                    åˆ é™¤
                                                </el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </el-tab-pane>
                            </el-tabs>
                        </el-tab-pane>
                        
                        <!-- æ’ä»¶ä¿®å¤æ ‡ç­¾é¡µ -->
                        <el-tab-pane label="ğŸ”§ æ’ä»¶ä¿®å¤" name="repair">
                            <div style="margin-bottom: 20px;">
                                <p style="color: #666; margin-bottom: 16px;">
                                    æ­¤åŠŸèƒ½ç”¨äºä¿®å¤ComfyUIæ’ä»¶ç›¸å…³é—®é¢˜ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹åŠ è½½é”™è¯¯ã€ä¾èµ–ç¼ºå¤±ç­‰ã€‚
                                </p>
                                <el-button type="primary" @click="startPluginRepair">ğŸš€ å¼€å§‹ä¿®å¤æ‰«æ</el-button>
                                <el-button @click="refreshPluginStatus">ğŸ”„ åˆ·æ–°çŠ¶æ€</el-button>
                            </div>
                            
                            <!-- ä¿®å¤è¿›åº¦ -->
                            <div v-if="repairData.isScanning" class="progress-section">
                                <div style="margin-bottom: 12px;">
                                    <strong>ğŸ” æ‰«æè¿›åº¦: {{ repairData.progressText }}</strong>
                                </div>
                                <el-progress 
                                    :percentage="repairData.progressPercent" 
                                    :status="repairData.progressStatus"
                                    :stroke-width="12"
                                ></el-progress>
                            </div>
                            
                            <!-- æ‰«æç»“æœ -->
                            <div v-if="repairData.issues.length > 0" style="margin-top: 20px;">
                                <h4 style="margin-bottom: 12px;">ğŸ” æ£€æµ‹åˆ°çš„é—®é¢˜:</h4>
                                <el-table 
                                    :data="repairData.issues" 
                                    style="width: 100%"
                                    :height="400"
                                >
                                    <el-table-column prop="type" label="é—®é¢˜ç±»å‹" width="120">
                                        <template #default="scope">
                                            <el-tag 
                                                :type="scope.row.type === 'error' ? 'danger' : 
                                                      scope.row.type === 'warning' ? 'warning' : 'info'"
                                            >
                                                {{ scope.row.type === 'error' ? 'é”™è¯¯' : 
                                                   scope.row.type === 'warning' ? 'è­¦å‘Š' : 'ä¿¡æ¯' }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="description" label="é—®é¢˜æè¿°" min-width="300"></el-table-column>
                                    <el-table-column prop="location" label="ä½ç½®" width="200"></el-table-column>
                                </el-table>
                            </div>
                            
                            <!-- ä¿®å¤æ—¥å¿— -->
                            <div class="log-section">
                                <h4 style="margin-bottom: 12px;">ğŸ“ ä¿®å¤æ—¥å¿—:</h4>
                                <div class="log-container" ref="repairLogContainer">
                                    <div 
                                        v-for="(log, index) in repairData.logs" 
                                        :key="index" 
                                        class="log-entry"
                                        :class="log.type"
                                    >
                                        {{ log.timestamp }} - {{ log.message }}
                                    </div>
                                    <div v-if="repairData.logs.length === 0" style="color: #999; text-align: center; padding: 20px;">
                                        ç­‰å¾…å¼€å§‹æ‰«æ...
                                    </div>
                                </div>
                            </div>
                        </el-tab-pane>
                        
                        <!-- è®¾ç½®æ ‡ç­¾é¡µ -->
                        <el-tab-pane label="âš™ï¸ è®¾ç½®" name="settings">
                            <!-- åŸºæœ¬è®¾ç½® -->
                            <div class="settings-section">
                                <h3>ğŸŒ æµè§ˆå™¨è®¾ç½®</h3>
                                <div class="form-row">
                                    <label>Chromeè·¯å¾„:</label>
                                    <el-input 
                                        v-model="settingsData.chromePath" 
                                        placeholder="è‡ªåŠ¨æ£€æµ‹Chromeæµè§ˆå™¨è·¯å¾„"
                                    ></el-input>
                                    <el-button @click="browseChromePath">æµè§ˆ...</el-button>
                                </div>
                                <div class="form-row">
                                    <label></label>
                                    <el-checkbox v-model="settingsData.autoOpenHtml">åˆ†æå®Œæˆåè‡ªåŠ¨æ‰“å¼€HTMLç»“æœ</el-checkbox>
                                </div>
                            </div>
                            
                            <!-- ä¸»é¢˜è®¾ç½® -->
                            <div class="settings-section">
                                <h3>ğŸ¨ ä¸»é¢˜è®¾ç½®</h3>
                                <div class="form-row">
                                    <label>ç•Œé¢ä¸»é¢˜:</label>
                                    <el-select v-model="settingsData.theme" placeholder="é€‰æ‹©ä¸»é¢˜">
                                        <el-option label="Cosmo (é»˜è®¤)" value="cosmo"></el-option>
                                        <el-option label="Flatly" value="flatly"></el-option>
                                        <el-option label="Journal" value="journal"></el-option>
                                        <el-option label="Litera" value="litera"></el-option>
                                    </el-select>
                                </div>
                                <div class="form-row">
                                    <label></label>
                                    <el-checkbox v-model="settingsData.randomTheme">å¯åŠ¨æ—¶éšæœºä¸»é¢˜</el-checkbox>
                                </div>
                            </div>
                            
                            <!-- æ–‡ä»¶ç®¡ç†è®¾ç½® -->
                            <div class="settings-section">
                                <h3>ğŸ“ æ–‡ä»¶ç®¡ç†è®¾ç½®</h3>
                                <div class="form-row">
                                    <label>ç»“æœä¿ç•™å¤©æ•°:</label>
                                    <el-input-number 
                                        v-model="settingsData.retentionDays" 
                                        :min="1" 
                                        :max="365" 
                                        style="width: 150px;"
                                    ></el-input-number>
                                    <span style="margin-left: 8px; color: #666;">å¤©</span>
                                </div>
                            </div>
                            
                            <!-- ä¿å­˜è®¾ç½® -->
                            <div style="margin-top: 24px;">
                                <el-button type="primary" @click="saveSettings">ğŸ’¾ ä¿å­˜è®¾ç½®</el-button>
                                <el-button @click="resetSettings">ğŸ”„ é‡ç½®ä¸ºé»˜è®¤</el-button>
                            </div>
                        </el-tab-pane>
                        
                    </el-tabs>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    activeTab: 'single',
                    apiBaseUrl: 'http://localhost:8000',
                    isDragOver: false,
                    
                    // å•ä¸ªå¤„ç†æ•°æ®
                    singleData: {
                        workflowPath: '',
                        selectedFile: null,
                        isAnalyzing: false,
                        progressPercent: 0,
                        progressText: '0%',
                        progressStatus: '',
                        hasResults: false,
                        logs: [],
                        analysisResults: [],  // ä¿å­˜åˆ†æç»“æœ
                        lastAnalysisTime: null
                    },
                    
                    // æ‰¹é‡å¤„ç†æ•°æ®
                    batchData: {
                        workflowDir: '',
                        filePattern: '*.json;*',
                        autoOpenResult: true,
                        isProcessing: false,
                        progressPercent: 0,
                        progressText: '0%',
                        progressStatus: '',
                        results: []
                    },
                    
                    // ä¸è§„åˆ™åç§°æ˜ å°„æ•°æ®
                    irregularData: {
                        mappings: [],
                        newMapping: {
                            original: '',
                            corrected: '',
                            notes: ''
                        }
                    },
                    
                    // æ¨¡å‹é…ç½®æ•°æ®
                    configData: {
                        activeSubTab: 'nodeTypes',
                        nodeTypes: [],
                        extensions: [],
                        newNodeType: '',
                        newExtension: ''
                    },
                    
                    // æ’ä»¶ä¿®å¤æ•°æ®
                    repairData: {
                        isScanning: false,
                        progressPercent: 0,
                        progressText: '0%',
                        progressStatus: '',
                        issues: [],
                        logs: []
                    },
                    
                    // è®¾ç½®æ•°æ®
                    settingsData: {
                        chromePath: '',
                        autoOpenHtml: true,
                        theme: 'cosmo',
                        randomTheme: false,
                        retentionDays: 30
                    }
                }
            },
            
            mounted() {
                this.initializeData();
            },
            
            methods: {
                async initializeData() {
                    await this.loadIrregularMappings();
                    await this.loadModelConfig();
                },
                
                handleTabChange(tabName) {
                    console.log('åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ:', tabName);
                },
                
                // === å•ä¸ªå¤„ç†ç›¸å…³æ–¹æ³• ===
                browseSingleWorkflow() {
                    this.$refs.fileInput.click();
                },
                
                triggerFileInput() {
                    this.$refs.fileInput.click();
                },
                
                handleFileSelect(event) {
                    const file = event.target.files[0];
                    if (file && file.type === 'application/json') {
                        this.singleData.selectedFile = file;
                        this.singleData.workflowPath = file.name;
                        ElMessage.success(`å·²é€‰æ‹©æ–‡ä»¶: ${file.name}`);
                    } else {
                        ElMessage.error('è¯·é€‰æ‹©æœ‰æ•ˆçš„ JSON æ–‡ä»¶');
                    }
                },
                
                handleDragOver(event) {
                    this.isDragOver = true;
                },
                
                handleDragLeave(event) {
                    this.isDragOver = false;
                },
                
                handleDrop(event) {
                    this.isDragOver = false;
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        if (file.type === 'application/json') {
                            this.singleData.selectedFile = file;
                            this.singleData.workflowPath = file.name;
                            ElMessage.success(`å·²é€‰æ‹©æ–‡ä»¶: ${file.name}`);
                        } else {
                            ElMessage.error('è¯·é€‰æ‹©æœ‰æ•ˆçš„ JSON æ–‡ä»¶');
                        }
                    }
                },
                
                async analyzeSingle() {
                    if (!this.singleData.selectedFile && !this.singleData.workflowPath) {
                        ElMessage.error('è¯·å…ˆé€‰æ‹©å·¥ä½œæµæ–‡ä»¶');
                        return;
                    }
                    
                    this.singleData.isAnalyzing = true;
                    this.singleData.progressPercent = 0;
                    this.singleData.progressText = 'å¼€å§‹åˆ†æ...';
                    this.singleData.logs = [];
                    this.addLog('single', 'info', 'å¼€å§‹åˆ†æå·¥ä½œæµæ–‡ä»¶...');
                    
                    try {
                        const formData = new FormData();
                        if (this.singleData.selectedFile) {
                            formData.append('file', this.singleData.selectedFile);
                        }
                        
                        this.updateProgress('single', 30, 'æ­£åœ¨åˆ†ææ¨¡å‹ä¾èµ–...');
                        this.addLog('single', 'info', 'æ­£åœ¨è§£æJSONæ–‡ä»¶ç»“æ„...');
                        
                        const response = await fetch(`${this.apiBaseUrl}/api/analyze`, {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.updateProgress('single', 80, 'æ­£åœ¨ç”Ÿæˆæœç´¢é“¾æ¥...');
                            this.addLog('single', 'success', `åˆ†æå®Œæˆï¼Œå‘ç° ${result.count} ä¸ªæ¨¡å‹å¼•ç”¨`);
                            
                            // ä¿å­˜åˆ†æç»“æœ
                            this.singleData.analysisResults = result.models || [];
                            this.singleData.lastAnalysisTime = new Date().toLocaleString();
                            
                            this.updateProgress('single', 100, 'åˆ†æå®Œæˆï¼', 'success');
                            this.singleData.hasResults = true;
                            this.addLog('single', 'success', 'ç»“æœå·²ç”Ÿæˆï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯');
                            
                            // è‡ªåŠ¨æ‰“å¼€æœç´¢é“¾æ¥
                            if (this.singleData.analysisResults.length > 0) {
                                this.addLog('single', 'info', 'æ­£åœ¨æ‰“å¼€æœç´¢é¡µé¢...');
                                this.openSearchLinksForResults();
                            }
                            
                            setTimeout(() => {
                                this.singleData.isAnalyzing = false;
                            }, 500);
                            
                            ElMessage.success(`åˆ†æå®Œæˆï¼å‘ç° ${result.count} ä¸ªæ¨¡å‹å¼•ç”¨`);
                        } else {
                            throw new Error(result.message || 'åˆ†æå¤±è´¥');
                        }
                        
                    } catch (error) {
                        this.addLog('single', 'error', `åˆ†æå¤±è´¥: ${error.message}`);
                        this.updateProgress('single', 0, 'åˆ†æå¤±è´¥', 'exception');
                        ElMessage.error(`åˆ†æå¤±è´¥: ${error.message}`);
                        
                        setTimeout(() => {
                            this.singleData.isAnalyzing = false;
                        }, 2000);
                    }
                },
                
                viewSingleResult() {
                    if (!this.singleData.hasResults) {
                        ElMessage.warning('æ²¡æœ‰å¯æŸ¥çœ‹çš„ç»“æœ');
                        return;
                    }
                    
                    // æ˜¾ç¤ºåˆ†æç»“æœè¯¦æƒ…å¯¹è¯æ¡†
                    this.showAnalysisResultDialog();
                },
                
                showAnalysisResultDialog() {
                    // ä½¿ç”¨Element Plusçš„å¯¹è¯æ¡†æ˜¾ç¤ºç»“æœ
                    const h = ElementPlus.ElMessageBox.h;
                    
                    ElMessageBox({
                        title: 'ğŸ“Š åˆ†æç»“æœè¯¦æƒ…',
                        message: h('div', { style: 'max-height: 500px; overflow-y: auto;' }, [
                            h('p', { style: 'margin-bottom: 16px; color: #666;' }, 
                              `åˆ†ææ—¶é—´: ${this.singleData.lastAnalysisTime || 'æœªçŸ¥'}`),
                            h('p', { style: 'margin-bottom: 16px; font-weight: bold;' }, 
                              `å‘ç° ${this.singleData.analysisResults.length} ä¸ªæ¨¡å‹å¼•ç”¨`),
                            ...this.singleData.analysisResults.map((model, index) => 
                                h('div', { 
                                    key: index,
                                    style: 'border: 1px solid #eee; padding: 12px; margin-bottom: 8px; border-radius: 4px; background: #fafafa;'
                                }, [
                                    h('div', { style: 'font-weight: bold; margin-bottom: 4px;' }, 
                                      model.filename || model.name || 'æœªçŸ¥æ¨¡å‹'),
                                    h('div', { style: 'font-size: 12px; color: #666; margin-bottom: 8px;' }, 
                                      `èŠ‚ç‚¹ç±»å‹: ${model.node_type || 'æœªçŸ¥'} | èŠ‚ç‚¹ID: ${model.node_id || 'æœªçŸ¥'}`),
                                    model.search_link ? h('button', {
                                        style: 'background: #409eff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-right: 8px;',
                                        onClick: () => window.open(model.search_link, '_blank')
                                    }, 'ğŸ” æœç´¢') : null,
                                    model.download_link ? h('button', {
                                        style: 'background: #67c23a; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;',
                                        onClick: () => window.open(model.download_link, '_blank')
                                    }, 'ğŸ“¥ ä¸‹è½½') : null
                                ])
                            )
                        ]),
                        showCancelButton: true,
                        confirmButtonText: 'ğŸ” æ‰“å¼€æ‰€æœ‰æœç´¢',
                        cancelButtonText: 'å…³é—­',
                        customClass: 'result-dialog'
                    }).then(() => {
                        // ç”¨æˆ·ç‚¹å‡»äº†"æ‰“å¼€æ‰€æœ‰æœç´¢"
                        this.openSearchLinksForResults();
                    }).catch(() => {
                        // ç”¨æˆ·å–æ¶ˆäº†
                    });
                },
                
                openSearchLinksForResults() {
                    const searchLinks = this.singleData.analysisResults
                        .filter(model => model.search_link)
                        .slice(0, 3); // é™åˆ¶æœ€å¤š3ä¸ªï¼Œé¿å…æµè§ˆå™¨é˜»æ­¢
                    
                    if (searchLinks.length === 0) {
                        this.addLog('single', 'warning', 'æ²¡æœ‰å¯ç”¨çš„æœç´¢é“¾æ¥');
                        return;
                    }
                    
                    this.addLog('single', 'info', `æ­£åœ¨æ‰“å¼€ ${searchLinks.length} ä¸ªæœç´¢é¡µé¢...`);
                    
                    searchLinks.forEach((model, index) => {
                        setTimeout(() => {
                            window.open(model.search_link, '_blank');
                            this.addLog('single', 'success', `å·²æ‰“å¼€: ${model.filename || model.name}`);
                        }, index * 800); // é—´éš”800msæ‰“å¼€ï¼Œé¿å…è¢«æµè§ˆå™¨é˜»æ­¢
                    });
                    
                    if (this.singleData.analysisResults.length > 3) {
                        this.addLog('single', 'info', `è¿˜æœ‰ ${this.singleData.analysisResults.length - 3} ä¸ªæ¨¡å‹ï¼Œå¯é€šè¿‡"æŸ¥çœ‹ç»“æœ"æŸ¥çœ‹è¯¦æƒ…`);
                    }
                },
                
                // === æ‰¹é‡å¤„ç†ç›¸å…³æ–¹æ³• ===
                browseBatchWorkflowDir() {
                    ElMessage.info('åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ‰“å¼€ç›®å½•é€‰æ‹©å¯¹è¯æ¡†');
                },
                
                async startBatchProcess() {
                    if (!this.batchData.workflowDir) {
                        ElMessage.error('è¯·å…ˆé€‰æ‹©å·¥ä½œæµç›®å½•');
                        return;
                    }
                    
                    this.batchData.isProcessing = true;
                    this.batchData.progressPercent = 0;
                    this.batchData.progressText = 'æ‰«æç›®å½•ä¸­...';
                    this.batchData.results = [];
                    
                    try {
                        this.updateProgress('batch', 20, 'æ­£åœ¨æ‰«ææ–‡ä»¶...');
                        await this.sleep(1000);
                        
                        this.updateProgress('batch', 60, 'æ­£åœ¨å¤„ç†æ–‡ä»¶...');
                        await this.sleep(2000);
                        
                        this.batchData.results = [
                            { filename: 'workflow1.json', missingCount: 3, status: 'å®Œæˆ' },
                            { filename: 'workflow2.json', missingCount: 1, status: 'å®Œæˆ' },
                            { filename: 'workflow3.json', missingCount: 0, status: 'å®Œæˆ' }
                        ];
                        
                        this.updateProgress('batch', 100, 'æ‰¹é‡å¤„ç†å®Œæˆï¼', 'success');
                        
                        setTimeout(() => {
                            this.batchData.isProcessing = false;
                        }, 500);
                        
                        ElMessage.success('æ‰¹é‡å¤„ç†å®Œæˆï¼');
                        
                    } catch (error) {
                        this.updateProgress('batch', 0, 'å¤„ç†å¤±è´¥', 'exception');
                        ElMessage.error(`æ‰¹é‡å¤„ç†å¤±è´¥: ${error.message}`);
                        
                        setTimeout(() => {
                            this.batchData.isProcessing = false;
                        }, 2000);
                    }
                },
                
                viewBatchHtml() {
                    ElMessage.info('å°†æ‰“å¼€æ‰¹é‡å¤„ç†æ±‡æ€»HTMLç»“æœ');
                },
                
                // === ä¸è§„åˆ™åç§°æ˜ å°„ç›¸å…³æ–¹æ³• ===
                async loadIrregularMappings() {
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/api/irregular-names`);
                        const result = await response.json();
                        if (result.status === 'success' && Array.isArray(result.data)) {
                            this.irregularData.mappings = result.data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½ä¸è§„åˆ™åç§°æ˜ å°„å¤±è´¥:', error);
                    }
                },
                
                async addMapping() {
                    if (!this.irregularData.newMapping.original || !this.irregularData.newMapping.corrected) {
                        ElMessage.error('åŸå§‹åç§°å’Œä¿®æ­£åç§°ä¸èƒ½ä¸ºç©º');
                        return;
                    }
                    
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/api/irregular-names`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.irregularData.newMapping)
                        });
                        
                        const result = await response.json();
                        if (result.status === 'success') {
                            await this.loadIrregularMappings();
                            this.irregularData.newMapping = { original: '', corrected: '', notes: '' };
                            ElMessage.success('æ˜ å°„æ·»åŠ æˆåŠŸ');
                        } else {
                            throw new Error(result.message);
                        }
                    } catch (error) {
                        ElMessage.error(`æ·»åŠ æ˜ å°„å¤±è´¥: ${error.message}`);
                    }
                },
                
                async deleteMapping(mapping) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ˜ å°„å—ï¼Ÿ', 'ç¡®è®¤åˆ é™¤', {
                            type: 'warning'
                        });
                        
                        ElMessage.success('æ˜ å°„åˆ é™¤æˆåŠŸ');
                        await this.loadIrregularMappings();
                    } catch (error) {
                        // ç”¨æˆ·å–æ¶ˆåˆ é™¤
                    }
                },
                
                // === æ¨¡å‹é…ç½®ç›¸å…³æ–¹æ³• ===
                async loadModelConfig() {
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/api/model-config`);
                        const result = await response.json();
                        if (result.status === 'success') {
                            const config = result.data;
                            
                            this.configData.nodeTypes = config.model_node_types ? 
                                config.model_node_types.map(type => ({ name: type })) : [];
                            
                            this.configData.extensions = config.model_extensions ? 
                                config.model_extensions.map(ext => ({ extension: ext })) : [];
                        }
                    } catch (error) {
                        console.error('åŠ è½½æ¨¡å‹é…ç½®å¤±è´¥:', error);
                    }
                },
                
                addNodeType() {
                    if (!this.configData.newNodeType) return;
                    
                    this.configData.nodeTypes.push({ name: this.configData.newNodeType });
                    this.configData.newNodeType = '';
                    ElMessage.success('èŠ‚ç‚¹ç±»å‹æ·»åŠ æˆåŠŸ');
                },
                
                removeNodeType(nodeType, index) {
                    this.configData.nodeTypes.splice(index, 1);
                    ElMessage.success('èŠ‚ç‚¹ç±»å‹åˆ é™¤æˆåŠŸ');
                },
                
                addExtension() {
                    if (!this.configData.newExtension) return;
                    
                    let ext = this.configData.newExtension;
                    if (!ext.startsWith('.')) ext = '.' + ext;
                    
                    this.configData.extensions.push({ extension: ext });
                    this.configData.newExtension = '';
                    ElMessage.success('æ–‡ä»¶æ‰©å±•åæ·»åŠ æˆåŠŸ');
                },
                
                removeExtension(extension, index) {
                    this.configData.extensions.splice(index, 1);
                    ElMessage.success('æ–‡ä»¶æ‰©å±•ååˆ é™¤æˆåŠŸ');
                },
                
                refreshModelConfig() {
                    this.loadModelConfig();
                    ElMessage.success('æ¨¡å‹é…ç½®å·²åˆ·æ–°');
                },
                
                resetModelConfig() {
                    ElMessage.info('é‡ç½®é…ç½®åŠŸèƒ½å¼€å‘ä¸­');
                },
                
                // === æ’ä»¶ä¿®å¤ç›¸å…³æ–¹æ³• ===
                async startPluginRepair() {
                    this.repairData.isScanning = true;
                    this.repairData.progressPercent = 0;
                    this.repairData.progressText = 'å¼€å§‹æ‰«æ...';
                    this.repairData.logs = [];
                    this.repairData.issues = [];
                    
                    this.addLog('repair', 'info', 'å¼€å§‹æ‰«æComfyUIæ’ä»¶...');
                    
                    try {
                        this.updateProgress('repair', 20, 'æ‰«ææ’ä»¶ç›®å½•...');
                        this.addLog('repair', 'info', 'æ­£åœ¨æ‰«ææ’ä»¶ç›®å½•ç»“æ„...');
                        await this.sleep(1000);
                        
                        this.updateProgress('repair', 50, 'æ£€æŸ¥èŠ‚ç‚¹å®šä¹‰...');
                        this.addLog('repair', 'info', 'æ­£åœ¨æ£€æŸ¥èŠ‚ç‚¹å®šä¹‰æ–‡ä»¶...');
                        await this.sleep(1500);
                        
                        this.updateProgress('repair', 80, 'åˆ†æä¾èµ–å…³ç³»...');
                        this.addLog('repair', 'info', 'æ­£åœ¨åˆ†ææ’ä»¶ä¾èµ–å…³ç³»...');
                        await this.sleep(1000);
                        
                        this.repairData.issues = [
                            {
                                type: 'error',
                                description: 'ç¼ºå°‘å¿…éœ€çš„ä¾èµ–åŒ…: torch',
                                location: 'ComfyUI/custom_nodes/example_plugin'
                            },
                            {
                                type: 'warning',
                                description: 'èŠ‚ç‚¹ç±»åå†²çª: SampleNode',
                                location: 'ComfyUI/custom_nodes/plugin_a/nodes.py'
                            }
                        ];
                        
                        this.updateProgress('repair', 100, 'æ‰«æå®Œæˆï¼', 'success');
                        this.addLog('repair', 'success', `æ‰«æå®Œæˆï¼Œå‘ç° ${this.repairData.issues.length} ä¸ªé—®é¢˜`);
                        
                        setTimeout(() => {
                            this.repairData.isScanning = false;
                        }, 500);
                        
                        ElMessage.success(`æ‰«æå®Œæˆï¼å‘ç° ${this.repairData.issues.length} ä¸ªé—®é¢˜`);
                        
                    } catch (error) {
                        this.addLog('repair', 'error', `æ‰«æå¤±è´¥: ${error.message}`);
                        this.updateProgress('repair', 0, 'æ‰«æå¤±è´¥', 'exception');
                        ElMessage.error(`æ‰«æå¤±è´¥: ${error.message}`);
                        
                        setTimeout(() => {
                            this.repairData.isScanning = false;
                        }, 2000);
                    }
                },
                
                refreshPluginStatus() {
                    ElMessage.success('æ’ä»¶çŠ¶æ€å·²åˆ·æ–°');
                },
                
                // === è®¾ç½®ç›¸å…³æ–¹æ³• ===
                browseChromePath() {
                    ElMessage.info('åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†');
                },
                
                async saveSettings() {
                    try {
                        ElMessage.success('è®¾ç½®ä¿å­˜æˆåŠŸ');
                    } catch (error) {
                        ElMessage.error(`ä¿å­˜è®¾ç½®å¤±è´¥: ${error.message}`);
                    }
                },
                
                resetSettings() {
                    this.settingsData = {
                        chromePath: '',
                        autoOpenHtml: true,
                        theme: 'cosmo',
                        randomTheme: false,
                        retentionDays: 30
                    };
                    ElMessage.success('è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
                },
                
                // === è¾…åŠ©æ–¹æ³• ===
                updateProgress(module, percent, text, status = '') {
                    if (module === 'single') {
                        this.singleData.progressPercent = percent;
                        this.singleData.progressText = text;
                        this.singleData.progressStatus = status;
                    } else if (module === 'batch') {
                        this.batchData.progressPercent = percent;
                        this.batchData.progressText = text;
                        this.batchData.progressStatus = status;
                    } else if (module === 'repair') {
                        this.repairData.progressPercent = percent;
                        this.repairData.progressText = text;
                        this.repairData.progressStatus = status;
                    }
                },
                
                addLog(module, type, message) {
                    const timestamp = new Date().toLocaleTimeString();
                    const logEntry = { timestamp, type, message };
                    
                    if (module === 'single') {
                        this.singleData.logs.push(logEntry);
                        this.$nextTick(() => {
                            const container = this.$refs.singleLogContainer;
                            if (container) container.scrollTop = container.scrollHeight;
                        });
                    } else if (module === 'repair') {
                        this.repairData.logs.push(logEntry);
                        this.$nextTick(() => {
                            const container = this.$refs.repairLogContainer;
                            if (container) container.scrollTop = container.scrollHeight;
                        });
                    }
                },
                
                sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>
